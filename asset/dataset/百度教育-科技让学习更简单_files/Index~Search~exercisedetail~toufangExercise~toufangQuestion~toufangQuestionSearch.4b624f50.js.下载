(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Index~Search~exercisedetail~toufangExercise~toufangQuestion~toufangQuestionSearch"],{"05ed":function(t,e,i){"use strict";i("f44b")},"895d":function(t,e,i){"use strict";i("b0c0");var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"ugc-dialog"},["select"==t.dialogStatus?e("div",{staticClass:"select-dialog"},[e("p",{staticClass:"title-dialog"},[t._v("请选择要上传的内容类型")]),e("div",{staticClass:"ugc-options"},t._l(t.ugcOptions,(function(i,a){return e("div",{key:a,staticClass:"ugc-item",attrs:{title:i.title},on:{click:function(e){return t.selectUgcType(i.type)}}},[e("img",{attrs:{src:i.icon}}),e("span",[t._v(t._s(i.title))])])})),0),e("img",{staticClass:"close-dialog",attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663903012940/d9f69e5250da.png",alt:"关闭",title:"关闭"},on:{click:t.closeDialog}})]):"shiti"==t.dialogStatus?e("div",{staticClass:"select-dialog shiti-dialog"},[e("p",{staticClass:"title-dialog"},[t._v("上传试题")]),e("img",{staticClass:"close-dialog",attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663903012940/d9f69e5250da.png",alt:"关闭",title:"关闭"},on:{click:t.closeDialog}}),e("div",{staticClass:"shiti-item"},[t._m(0),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.qbTitle,expression:"qbTitle"}],staticClass:"shiti-input",attrs:{placeholder:"如果是选择题，试题内容需要包含选项"},domProps:{value:t.qbTitle},on:{change:t.checkCanCommit,input:function(e){e.target.composing||(t.qbTitle=e.target.value)}}})]),e("div",{staticClass:"shiti-item"},[t._m(1),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.qbAnswer,expression:"qbAnswer"}],staticClass:"shiti-input",attrs:{placeholder:"请输入完整答案"},domProps:{value:t.qbAnswer},on:{change:t.checkCanCommit,input:function(e){e.target.composing||(t.qbAnswer=e.target.value)}}})]),e("div",{staticClass:"shiti-item"},[e("p",{staticClass:"shiti-title"},[t._v(" 解析 ")]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.qbAnalysic,expression:"qbAnalysic"}],staticClass:"shiti-input",attrs:{placeholder:"如果没有解析，可以不填写"},domProps:{value:t.qbAnalysic},on:{input:function(e){e.target.composing||(t.qbAnalysic=e.target.value)}}})]),e("div",{staticClass:"shiti-item grade"},[t._m(2),e("select",{staticClass:"gradelist",on:{change:t.getGradeSelected}},t._l(t.gradeList,(function(i,a){return e("option",{key:a,staticClass:"gradeitem",domProps:{value:a}},[t._v(" "+t._s(i.label)+" ")])})),0),t._m(3),e("select",{staticClass:"gradelist",on:{change:t.getSubjectSelected}},t._l(t.subjectList,(function(i,a){return e("option",{key:a,staticClass:"gradeitem",domProps:{value:i.knowType}},[t._v(" "+t._s(i.label)+" ")])})),0)]),e("div",{staticClass:"commit-btn",class:{"active-btn":t.canCommit},attrs:{title:"提交"},on:{click:t.commitInfo}},[t._v(" 提交 ")])]):"video"==t.dialogStatus?e("div",{staticClass:"select-dialog video"},[e("p",{staticClass:"title-dialog"},[t._v("上传视频")]),e("img",{staticClass:"close-dialog",attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663903012940/d9f69e5250da.png",alt:"关闭",title:"关闭"},on:{click:t.closeDialog}}),e("div",{staticClass:"video-item"},[t._m(4),e("input",{directives:[{name:"model",rawName:"v-model",value:t.videoTitle,expression:"videoTitle"}],staticClass:"video-title-input",attrs:{placeholder:"请输入视频名称"},domProps:{value:t.videoTitle},on:{change:t.checkCanCommit,input:function(e){e.target.composing||(t.videoTitle=e.target.value)}}})]),e("div",{staticClass:"video-item dec-item"},[t._m(5),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.videoDec,expression:"videoDec"}],staticClass:"video-dec",attrs:{placeholder:"请输入视频描述"},domProps:{value:t.videoDec},on:{change:t.checkCanCommit,input:function(e){e.target.composing||(t.videoDec=e.target.value)}}})]),e("div",{staticClass:"video-upload-con"},[e("div",{staticClass:"video-item"},[t._m(6),"pendding"===t.uploadStatus?e("div",{staticClass:"video-upload"},[e("img",{attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663659721007/91499c0bcc92.png",alt:""}}),e("input",{ref:"file",attrs:{id:"uploadFile",type:"file",single:"",accept:"image/*",title:"上传封面图"},on:{click:function(t){t.target.value=""},change:t.uploadVideoCover}})]):"uploading"===t.uploadStatus?e("div",{staticClass:"video-cover",style:"background-image: url("+t.videoCoverImg+")"},[t.progressNum<100?e("div",{staticClass:"upload-progress"},[e("div",{staticClass:"noupload"}),e("p",{staticClass:"uploadnum"},[t._v(t._s(t.progressNum)+"%")])]):t._e(),e("img",{staticClass:"delete-upload",attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663661048875/521df8eab922.png",alt:"删除上传"},on:{click:function(e){return t.deletcUpload("videocover")}}})]):t._e(),e("p",{staticClass:"upload-tip"},[t._v("封面尺寸16:9，单个大小5MB以下")])]),e("div",{staticClass:"video-item"},[t._m(7),"pendding"===t.videoUploadStatus?e("div",{staticClass:"video-upload"},[e("img",{attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663659721007/91499c0bcc92.png",alt:""}}),e("input",{ref:"videofile",attrs:{id:"uploadFile",type:"file",single:"",accept:"audio/mp4, video/mp4",title:"上传视频"},on:{click:function(t){t.target.value=""},change:t.uploadVideo}})]):"uploading"===t.videoUploadStatus?e("div",{staticClass:"video-cover"},[e("video",{staticClass:"video-con",attrs:{src:t.uploadVideoUrl}}),t.progressVideoNum<100?e("div",{staticClass:"upload-progress"},[e("div",{staticClass:"novideoupload"}),e("p",{staticClass:"uploadnum"},[t._v(t._s(t.progressVideoNum)+"%")])]):t._e(),e("img",{staticClass:"delete-upload",attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663661048875/521df8eab922.png",alt:"删除上传"},on:{click:function(e){return t.deletcUpload("video")}}})]):t._e(),e("p",{staticClass:"upload-tip"},[t._v("支持mp4压缩文件，单个大小500MB以下")])])]),e("div",{staticClass:"commit-btn",class:{"active-btn":t.canCommit},attrs:{title:"提交"},on:{click:t.commitInfo}},[t._v(" 提交 ")])]):"shijuan"==t.dialogStatus?e("div",{staticClass:"select-dialog shijuan"},[e("p",{staticClass:"title-dialog"},[t._v("上传试卷")]),e("img",{staticClass:"close-dialog",attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663903012940/d9f69e5250da.png",alt:"关闭",title:"关闭"},on:{click:t.closeDialog}}),e("div",{staticClass:"shijuan-item"},[t._m(8),e("input",{directives:[{name:"model",rawName:"v-model",value:t.sjTitle,expression:"sjTitle"}],staticClass:"shijuan-title-input",attrs:{placeholder:"请输入试卷名称"},domProps:{value:t.sjTitle},on:{change:t.checkCanCommit,input:function(e){e.target.composing||(t.sjTitle=e.target.value)}}})]),e("div",{staticClass:"shijuan-item dec-item"},[t._m(9),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.sjDec,expression:"sjDec"}],staticClass:"shijuan-dec",attrs:{placeholder:"请输入试卷描述"},domProps:{value:t.sjDec},on:{change:t.checkCanCommit,input:function(e){e.target.composing||(t.sjDec=e.target.value)}}})]),e("div",{staticClass:"shijuan-item"},[t._m(10),"pendding"===t.shijuanUploadStatus?e("div",{staticClass:"shijuan-upload"},[e("img",{attrs:{src:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663659721007/91499c0bcc92.png",alt:""}}),e("input",{ref:"shijuanfile",attrs:{id:"uploadFile",type:"file",single:"",accept:"application/msword, application/pdf",title:"上传试卷"},on:{click:function(t){t.target.value=""},change:t.uploadShijuan}})]):t._e(),"pendding"===t.shijuanUploadStatus?e("p",{staticClass:"upload-tip"},[t._v(" 支持word、pdf文件，单个大小500MB以下 ")]):t._e(),"uploading"===t.shijuanUploadStatus?e("div",{staticClass:"shijuan-file"},[e("img",{staticClass:"file-icon",attrs:{src:t.uploadShijuanObj.icon}}),e("div",{staticClass:"file-info"},[e("p",{staticClass:"file-title"},[t._v(t._s(t.uploadShijuanObj.name))]),t.progressNum<100?e("div",{staticClass:"upload-progressline"},[t._m(11),e("span",{staticClass:"uploadnum"},[t._v(t._s(t.progressNum)+"%")])]):e("p",{staticClass:"file-size"},[t._v(t._s(t.shijuanFileSize)+"M")])]),e("img",{staticClass:"file-noupload",attrs:{src:t.progressNum<100?"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663664354940/9a562aa52794.png":"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663840090390/b0a83f4d7f0e.png"},on:{click:t.deletcUpload}})]):t._e()]),e("div",{staticClass:"commit-btn",class:{"active-btn":t.canCommit},attrs:{title:"提交"},on:{click:t.commitInfo}},[t._v(" 提交 ")])]):t._e()])},s=[function(){var t=this,e=t._self._c;return e("p",{staticClass:"shiti-title"},[e("em",[t._v("*")]),t._v(" 题目 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"shiti-title"},[e("em",[t._v("*")]),t._v(" 答案 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"shiti-title"},[e("em",[t._v("*")]),t._v(" 选择年级 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"shiti-title subject-title"},[e("em",[t._v("*")]),t._v(" 选择学科 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"video-title"},[e("em",[t._v("*")]),t._v(" 视频名称 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"video-title"},[e("em",[t._v("*")]),t._v(" 视频描述 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"video-title"},[e("em",[t._v("*")]),t._v(" 解题视频封面图 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"video-title"},[e("em",[t._v("*")]),t._v(" 解题视频 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"shijuan-title"},[e("em",[t._v("*")]),t._v(" 试卷名称 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"shijuan-title"},[e("em",[t._v("*")]),t._v(" 试卷描述 ")])},function(){var t=this,e=t._self._c;return e("p",{staticClass:"shijuan-title"},[e("em",[t._v("*")]),t._v(" 试卷文件 ")])},function(){var t=this,e=t._self._c;return e("div",{staticClass:"progress-line"},[e("div",{staticClass:"hasupload"})])}],o=i("5530"),c=i("c7eb"),n=i("1da1"),l=(i("c975"),i("b680"),i("d3b7"),i("4795"),i("99af"),i("09c8")),d="https://jiaoyanyun.baidu.com";function u(t){return Object(l["a"])({url:"/edu-web/content/getknowtype",method:"get",params:t})}function r(t){return Object(l["a"])({url:d+"/tiku/ugc/shiti",method:"POST",params:t})}function p(t){return Object(l["a"])({url:d+"/tiku/ugc/uploadpic",method:"POST",headers:{"Content-Type":"multipart/form-data"},data:t})}function m(t){return Object(l["a"])({url:d+"/tiku/ugc/preuploadFile",method:"POST",data:t})}function h(t){return Object(l["a"])({url:d+"/tiku/ugc/uploadFile",method:"POST",data:t})}function v(t){return Object(l["a"])({url:d+"/tiku/ugc/compuploadFile",method:"POST",data:t})}function g(t){return Object(l["a"])({url:d+"/tiku/ugc/commit",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:t})}var f=i("ee47"),b=i("67c7"),C={shiti:"xiti",video:"shipin",shijuan:"shijuan"},_={props:{ubcId:{type:String,default:""},pageName:{type:String,default:""}},data:function(){return{dialogStatus:"select",ugcOptions:[{title:"上传试题",icon:"https://edu-public.cdn.bcebos.com/cms_data/2022-10/1665403135545/6b266d60b0c7.png",type:"shiti"},{title:"上传试卷",icon:"https://edu-public.cdn.bcebos.com/cms_data/2022-10/1665403124790/0c470a2b4095.png",type:"shijuan"},{title:"上传解题视频",icon:"https://edu-public.cdn.bcebos.com/cms_data/2022-10/1665402958455/172d51efa6de.png",type:"video"}],canCommit:!1,qbTitle:"",qbAnswer:"",qbAnalysic:"",gradeList:[{children:[],label:"选择年级"}],selectedKnowType:"",subjectList:[{knowType:-1,label:"选择学科"}],uploadStatus:"pendding",videoUploadStatus:"pendding",shijuanUploadStatus:"pendding",progressNum:0,videoTitle:"",videoDec:"",videoCoverImg:"",progressVideoNum:0,uploadVideoUrl:"",sjTitle:"",sjDec:"",uploadShijuanObj:{},shijuanFileSize:""}},watch:{qbTitle:function(t){this.qbTitle=this.checkTxtNum(t)},qbAnswer:function(t){this.qbAnswer=this.checkTxtNum(t)},qbAnalysic:function(t){this.qbAnalysic=this.checkTxtNum(t)}},created:function(){var t=this.$route.query.pagType;this.dialogStatus=t||"select","shiti"===this.dialogStatus&&this.getGradeList()},mounted:function(){b["a"].init(this.pageName,this.ubcId),this.sendLog({value:"page",ext:{ugcdialog:"view"}})},methods:{uploadVideoCover:function(){var t=this,e=this.$refs.file.files[0],i=new FormData;i.append("file",e),p(i).then((function(e){var i=e.cdnUrl;i?(t.videoCoverImg=i,t.uploadStatus="uploading",t.checkCanCommit(),t.$nextTick((function(){var e=document.querySelector(".noupload");t.changeProgress("videocover",e)}))):t.$toast("上传失败")}))["catch"]((function(){t.$toast("上传失败")}))},deletcUpload:function(t){"video"===t?(this.videoUploadStatus="pendding",this.uploadVideoUrl="",this.progressVideoNum=0):(this.uploadStatus="pendding",this.shijuanUploadStatus="pendding",this.videoCoverImg="",this.uploadShijuanObj={},this.progressNum=0),this.checkCanCommit()},uploadVideo:function(){var t=this;return Object(n["a"])(Object(c["a"])().mark((function e(){var i,a,s;return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.$refs.videofile.files[0],a=new FormData,a.append("file",i),e.next=5,f["a"].getFileMD5(i,2);case 5:s=e.sent,t.beforeUpload(i,s).then();case 7:case"end":return e.stop()}}),e)})))()},uploadShijuan:function(){var t=this;return Object(n["a"])(Object(c["a"])().mark((function e(){var i,a,s,o,n,l;return Object(c["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.$refs.shijuanfile.files[0],a={doc:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663839048495/ab5d3be7684f.png",pdf:"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663839059466/4571e2020f51.png"},s=new FormData,s.append("file",i),t.uploadShijuanObj={name:i.name,icon:i.type.indexOf("pdf")>-1?a.pdf:a.doc},t.shijuanUploadStatus="uploading",o=2097152,n=Math.ceil(i.size/o),t.shijuanFileSize=parseFloat(i.size/1048576).toFixed(2),t.$nextTick((function(){var e=document.querySelector(".hasupload");t.changeProgress("shijuan",e,n>10?2:4,n>10?300:100)})),e.next=12,f["a"].getFileMD5(i,2);case 12:l=e.sent,t.beforeUpload(i,l).then();case 14:case"end":return e.stop()}}),e)})))()},beforeUpload:function(t,e){var i=this;return new Promise((function(a){var s=new FormData;s.append("name",t.name),s.append("md5",e),m(s).then((function(s){var o=s.uploadKey;if(o){var c=File.prototype.slice,n=new FileReader,l=2097152,d=[],u=Math.ceil(t.size/l),r=0;n.onload=function(){r++,r<u?p():i.submitUpload(o,d,0,u,t,e)},n.onerror=function(){console.warn("FileReader error.")},p(),a()}function p(){var e=r*l,i=e+l>=t.size?t.size:e+l,a=c.call(t,e,i);n.readAsArrayBuffer(a),d.push(a)}}),(function(t){i.$message.error(t)}))}))},submitUpload:function(t,e,i,a,s,o){var l=this;return Object(n["a"])(Object(c["a"])().mark((function n(){var d,u,r,p,m,g;return Object(c["a"])().wrap((function(c){while(1)switch(c.prev=c.next){case 0:if(!(i<a)){c.next=10;break}d=e[i++],u=new FormData,u.append("uploadKey",t),u.append("file",d),u.append("chunk",i),u.append("chunkNum",a),h(u).then((function(c){l.submitUpload(t,e,i,a,s,o)}))["catch"]((function(t){l.$message.error(t)})),c.next=26;break;case 10:return r=new FormData,p=s.name,r.append("uploadKey",t),r.append("chunkNum",a),r.append("name",p),r.append("size",s.size),r.append("md5",o),c.next=19,v(r);case 19:if(m=c.sent,g=m.url,m.sourceId,g){c.next=25;break}return l.$toast("上传失败"),c.abrupt("return");case 25:"video"===l.dialogStatus?(l.uploadVideoUrl=g,l.videoUploadStatus="uploading",l.$nextTick((function(){var t=document.querySelector(".novideoupload");l.changeProgress("video",t)}))):"shijuan"===l.dialogStatus&&(l.uploadShijuanObj.cdnUrl=g);case 26:case"end":return c.stop()}}),n)})))()},changeProgress:function(t,e){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;if(e)var o=0,c="videocover"===t||"video"===t?1.84:2,n=setInterval((function(){"videocover"===t||"video"===t?e.setAttribute("style","left: ".concat(o*c,"px; border-radius: ").concat(o<4?"8px":"0 8px 8px 0",";")):e.setAttribute("style","width: ".concat(o*c,"px; border-radius: ").concat(100===o?"6px":"6px 0 0 6px",";")),o>99&&(clearInterval(n),i.checkCanCommit()),o+=a,!i.uploadShijuanObj.cdnUrl&&o>78&&"shijuan"===t&&(o=78),!i.uploadVideoUrl&&o>78&&"video"===t&&(o=78),o=o>99?100:o,"video"===t?i.progressVideoNum=o:i.progressNum=o}),s)},selectUgcType:function(t){this.dialogStatus=t,"shiti"===this.dialogStatus&&this.getGradeList(),this.sendLog({value:"upload_selected",ext:{upload_type:C[this.dialogStatus]}})},checkCanCommit:function(){"shiti"===this.dialogStatus?this.canCommit=this.qbTitle&&this.qbAnswer&&this.selectedKnowType>0:"video"===this.dialogStatus?this.canCommit=this.videoTitle&&this.videoDec&&this.videoCoverImg&&this.uploadVideoUrl:"shijuan"===this.dialogStatus&&(this.canCommit=this.sjTitle&&this.sjDec&&this.uploadShijuanObj.cdnUrl)},checkTxtNum:function(t){var e=1500;return t.length<=e?t:(this.$toast("最多输入1500字"),t.substr(0,e))},getGradeList:function(){var t=this;u().then((function(e){var i=e.list;t.gradeList=t.gradeList.concat(i)}))},getGradeSelected:function(t){var e=t.target.value;if("0"===e)return this.subjectList=[{knowType:-1,label:"选择学科"}],void(this.selectedKnowType=-1);this.subjectList=this.subjectList.concat(this.gradeList[e].children),this.checkCanCommit()},getSubjectSelected:function(t){var e=t.target.value;this.selectedKnowType=e,this.checkCanCommit()},commitInfo:function(){var t=this;if("shiti"===this.dialogStatus&&this.canCommit)r({question:this.qbTitle,answer:this.qbAnswer,analyze:this.qbAnalysic,knowType:this.selectedKnowType}).then((function(e){t.commitToast(e.uploadRes)}));else if(("video"===this.dialogStatus||"shijuan"===this.dialogStatus)&&this.canCommit){var e={name:"video"===this.dialogStatus?this.videoTitle:this.sjTitle,desc:"video"===this.dialogStatus?this.videoDec:this.sjDec,metaType:"video"===this.dialogStatus?2:1,resourceUrl:"video"===this.dialogStatus?this.uploadVideoUrl:this.uploadShijuanObj.cdnUrl,picUrl:"video"===this.dialogStatus?this.videoCoverImg:""};g(e).then((function(e){t.commitToast(e.uploadRes)}))}this.sendLog({value:"submit",ext:{upload_type:C[this.dialogStatus]}})},commitToast:function(t){var e=this;t?(this.$toast("上传成功",2e3,"https://edu-public.cdn.bcebos.com/cms_data/2022-9/1663745470433/bcc6417f36d8.png"),setTimeout((function(){e.closeDialog()}),2e3)):this.$toast("上传失败")},closeDialog:function(){this.$emit("closeugc")},sendLog:function(t){b["a"].event(this.pageName,Object(o["a"])({page:this.pageName,type:"clk"},t))}}},j=_,S=(i("05ed"),i("2877")),k=Object(S["a"])(j,a,s,!1,null,"73b09372",null);e["a"]=k.exports},f44b:function(t,e,i){}}]);
//# sourceMappingURL=Index~Search~exercisedetail~toufangExercise~toufangQuestion~toufangQuestionSearch.4b624f50.js.map